let twbTrialFlowElementsInterval=null,twbTrialUpgradeData=null;function twbTrialFlowSendEventFromWidgets(t){twbSendEventToPublicRouth(t)}function twbTrialFlowSendEvent(t,e=""){if(!jQuery(t).closest(".twbb-tf-popup").length){const o=getLabelByClosestElement(t,e);twbSendEventToPublicRouth({eventCategory:"Free trial paywalls",eventAction:"Upgrade button click",eventLabel:o})}}function getLabelByClosestElement(t,e){const o={"MuiBox-root":{tooltip:"Editor: Top bar tooltip",button:"Editor: Top bar button"},"twbb-sg-sidebar-navigated-content":{tooltip:"Editor: Sections tooltip",button:"Editor: Sections button"},"twbb-image-gen-container":{tooltip:"Editor: Image generation pop up tooltip",button:"Editor: Image generation pop up button"},"twbb-ai-popup-container":{tooltip:"Editor: Text generation pop up tooltip",button:"Editor: Text generation pop up button"}};for(const n in o)if(t.closest("."+n))return o[n][e];return null}function twbCloseTrialFlowTooltip(t){jQuery(".twbb-tf-tooltip").removeClass("active"),jQuery("body").removeClass(t),localStorage.setItem(t+"_close","1")}function twbCloseTrialFlowPopup(){jQuery(".twbb-tf-tooltip").removeClass("twbb-tf-popup"),jQuery("body").removeClass("scroll_disclaimer"),jQuery(".twbb-image-gen-layout, .twbb-image-gen-container, .twbb-ai-popup-layout, .twbb-ai-popup-container").removeClass("low-z-index")}async function twbAddTrialFlowTooltip(t=""){const e=jQuery(".MuiToolbar-root .MuiBox-root .MuiGrid-root:nth-child(2)"),o=jQuery(".twbb-generate-with-ai-general-description"),n=jQuery(".twbb-ai-popup-container .twbb-ai-popup-header"),i=n.find(".twbb-ai-logo"),a=jQuery(".twbb-image-gen-topbar-action"),l=jQuery("#twbb-tf-tooltip-container");try{let r=await twbGetTrialLimitation();const{hosting_trial_expire_date:b}=r||{};void 0!==b&&""!==b&&l.length&&(e.length&&!jQuery(".MuiToolbar-root .twbb-tf-tooltip-container").length&&e.after(l.html()),o.length&&!jQuery(".twbb-sg-sidebar-navigated-content .twbb-tf-tooltip-container").length&&(o.after(jQuery(".MuiToolbar-root .twbb-tf-tooltip-container").clone()),jQuery(".twbb-sg-sidebar-navigated-content .twbb-tf-tooltip-container").addClass("big-size")),i.length&&!n.find(".twbb-tf-tooltip-container").length&&(i.after(l.html()),jQuery(".twbb-ai-popup-container").addClass("with-tf-element"),n.find(".twbb-tf-tooltip-container").addClass("big-size")),a.length&&!a.find(".twbb-tf-tooltip-container").length&&(a.append(l.html()),jQuery(".twbb-image-gen-topbar-action").addClass("with-tf-element"),a.find(".twbb-tf-tooltip-container").addClass("big-size")),twbUpdateTrialLimitationData(r),twbTrialFlowSetAutoPlay(),"init"===t&&twbSendEventToPublicRouth({eventCategory:"Free trial paywalls",eventAction:"Editor: Open Editor",eventLabel:"Open Editor"}))}catch(t){console.log("Error fetching trial limitation:",t)}}function twbFixTooltipPositionInSectionGeneration(){const t=jQuery(".twbb-sg-sidebar-navigated-content .twbb-tf-tooltip"),e=jQuery(".twbb-sg-sidebar-navigated-content .twbb-tf-element__right .upgrade-button"),o=e.outerWidth(),n=e.offset(),i=jQuery(window).scrollTop(),a=jQuery(".twbb-sg-sidebar-navigated-content .twbb-tf-tooltip__content").outerWidth();t.css({top:n.top-10-i+"px",left:n.left-a+o+"px",right:"auto",position:"fixed"})}function twbUpdateTrialLimitationData(t){const e=jQuery(".twbb-tf-tooltip-container"),o=e.find(".days-progress .fill"),n=e.find(".credits-progress .fill"),i=e.find(".days-left"),a=e.find(".credits");let l="",{already_used:r,plan_limit:b,hosting_trial_expire_date:c}=t||{};if(void 0!==r&&void 0!==b&&void 0!==c&&""!==c){const t=new Date,s=new Date(c)-t,u=new Date(c)-new Date(twbb_tf_tooltip.agreement_date),w=Math.ceil(u/864e5);let d=Math.ceil(s/864e5);d=d<1?1:d;const p=d>1?" days":" day";r=r>b?b:r,jQuery(".twbb-tf-tooltip__days-sub-title span").html(w),b<=r?(l="limitation-expired",localStorage.setItem("twbb_tf_credit_expired","1")):b/2<=r&&(l="half-used",!localStorage.getItem("twbb_tf_credit_close")&&d>1&&(twbShowTrialFlowActiveTooltip(),jQuery("body").addClass("twbb_tf_credit"))),d<=1&&(l+=" one-day-left"),e.addClass(l).removeClass("hidden"),i.html(d+p),a.html(r+"/"+b),o.width(100*d/3+"%"),n.width(r/b*100+"%"),d<2&&!localStorage.getItem("twbb_tf_ends_close")&&(twbShowTrialFlowActiveTooltip(),jQuery("body").addClass("twbb_tf_ends")),twbShowTrialFlowPopupOnceADay(c,d)}else localStorage.removeItem("twbb_tf_credit_expired")}function twbShowTrialFlowActiveTooltip(){let t=jQuery(".MuiBox-root");jQuery("twbb-image-gen-container").length?t=jQuery(".twbb-image-gen-container"):jQuery(".twbb-ai-popup-container:visible").length&&(t=jQuery(".twbb-ai-popup-container")),t.find(".twbb-tf-tooltip").addClass("active")}async function twbUpdateTrialLimitation(){try{twbUpdateTrialLimitationData(await twbGetTrialLimitation())}catch(t){console.log("Error fetching trial limitation:",t)}}function twbGetTrialLimitation(){return new Promise(((t,e)=>{try{if(!twbb_tf_tooltip||!twbb_tf_tooltip.ajaxurl||!twbb_tf_tooltip.twbb_tf_nonce)throw new Error("Missing AJAX configuration.");jQuery.ajax({type:"POST",url:twbb_tf_tooltip.ajaxurl,dataType:"json",data:{action:"twbb_get_trial_limits",nonce:twbb_tf_tooltip.twbb_tf_nonce},success:function(o){o&&o.success&&o.data&&o.data.data?t(o.data.data):e(new Error("Unexpected response format or request not successful."))},error:function(t,o,n){e(new Error(`AJAX error: ${o} - ${n}`))}})}catch(t){e(t)}}))}function twbShowTrialFlowCreditsExpired(t=""){const e=localStorage.getItem("twbb_tf_credit_expired");return!e||"1"!==e||!jQuery(".twbb-tf-tooltip-container").length||(jQuery(".MuiBox-root .twbb-tf-tooltip").addClass("twbb-tf-popup"),jQuery("body").addClass("scroll_disclaimer"),jQuery(".twbb-image-gen-layout, .twbb-image-gen-container, .twbb-ai-popup-layout, .twbb-ai-popup-container").addClass("low-z-index"),twbTrialFlowSendEventFromWidgets({eventCategory:"Free trial paywalls",eventAction:"Upgrade popup view",eventLabel:"Limitation"}),!1)}function twbShowTrialFlowPopupOnceADay(t,e){const o=new Date(t);if(new Date>o||e>2)return;let n=JSON.parse(localStorage.getItem("twbbTFPopup")||"{}");const i=(new Date).toDateString();n.lastShown!==i&&(n.count||0)<3&&(n.lastShown=i,n.count=(n.count||0)+1,localStorage.setItem("twbbTFPopup",JSON.stringify(n)),jQuery(".MuiBox-root  .twbb-tf-tooltip").addClass("twbb-tf-popup"),jQuery("body").addClass("scroll_disclaimer"),twbTrialFlowSendEventFromWidgets({eventCategory:"Free trial paywalls",eventAction:"Upgrade popup view",eventLabel:"Editor: Auto-open"}))}jQuery(document).ready((async function(){twbAddTrialFlowTooltip("init"),jQuery(document).on("click",".twbb-tf-tooltip.twbb-tf-popup",(function(){twbCloseTrialFlowPopup(),twbTrialUpgradeData=null})),jQuery(document).on("click",".twbb-tf-tooltip.twbb-tf-popup .got-it",(function(){twbSendEventToPublicRouth({eventCategory:"Free trial paywalls",eventAction:"Upgrade popup click",eventLabel:"Got it button"}),twbCloseTrialFlowPopup(),twbTrialUpgradeData=null})),jQuery(document).on("click",".twbb-tf-tooltip.twbb-tf-popup .upgrade-button",(function(){null!==twbTrialUpgradeData&&twbSendEventToPublicRouth(twbTrialUpgradeData),twbTrialUpgradeData=null})),jQuery(document).on("click","body.twbb_tf_ends .twbb-tf-tooltip-overlay",(function(){twbCloseTrialFlowTooltip("twbb_tf_ends")})),jQuery(document).on("click","body.twbb_tf_credit .twbb-tf-tooltip-overlay",(function(){twbCloseTrialFlowTooltip("twbb_tf_credit")})),jQuery(document).on("click",".twbb-tf-tooltip__content",(function(t){t.stopPropagation()})),jQuery(document).on("mouseover",".twbb-sg-sidebar-navigated-content .twbb-tf-tooltip-container",(function(t){twbFixTooltipPositionInSectionGeneration()})),jQuery(document).on("mouseleave",".twbb-sg-sidebar-navigated-content .twbb-tf-element__left, .twbb-sg-sidebar-navigated-content .twbb-tf-element__right, .twbb-sg-sidebar-navigated-content .twbb-tf-tooltip",(function(t){jQuery(this).closest(".twbb-tf-tooltip-container").find(".twbb-tf-tooltip").hide()})).on("mouseover",".twbb-sg-sidebar-navigated-content .twbb-tf-element__left, .twbb-sg-sidebar-navigated-content .twbb-tf-element__right, .twbb-sg-sidebar-navigated-content .twbb-tf-tooltip",(function(t){jQuery(this).closest(".twbb-tf-tooltip-container").find(".twbb-tf-tooltip").show()})),jQuery(document).find(".trial-upgrade-container-layer").length&&(twbUpgradePopupAnimation(),jQuery(document).on("click",".twbb-unlock-container .twbb-unlock-feature-button",(function(){twbSendEventToPublicRouth({eventCategory:"Onboarding",eventAction:"Section-based AI Flow - Start editing",eventLabel:"Section-based/Recreation-Editor loading"})})))}));const twbChangeTrialFlowElements=()=>{jQuery(".twbb-tf-element").each((function(){const t=jQuery(this),e=t.find(".twbb-tf-element__item.active"),o=e.next(".twbb-tf-element__item").length?e.next(".twbb-tf-element__item").index():0,n=t.find(".twbb-tf-element__item").eq(o);n.hasClass("active")||(t.find(".twbb-tf-element__item").removeClass("active"),n.addClass("active")),null===twbTrialFlowElementsInterval&&twbTrialFlowSetAutoPlay()}))},twbTrialFlowSetAutoPlay=()=>{null===twbTrialFlowElementsInterval&&(twbTrialFlowElementsInterval=setInterval((function(){twbChangeTrialFlowElements()}),3e3))};function twbUpgradePopupAnimation(){jQuery(".twbb-unlock-feature-button").on("click",(function(){jQuery(".trial-upgrade-container-layer, .trial-upgrade-container").remove()}));let t=!0,e=!1;jQuery(document).find(".trial-upgrade-container-layer").css("visibility","visible");function o(){const t=jQuery(".twbb-timeline-step");t.css({opacity:0,transform:"translateY(-10px)"}),t.each((function(t){setTimeout((()=>{jQuery(this).animate({opacity:1,top:0},{step:function(t,e){"top"===e.prop&&jQuery(this).css("transform",`translateY(${33*(1-t)}px)`)},duration:1e3,easing:"swing"}),3===t&&setTimeout((()=>{var t,e;t=1e3,e=600,jQuery("#trial-container").css({width:t+"px",height:e+"px",transition:"all 0.3s ease"}).one("transitionend webkitTransitionEnd oTransitionEnd",(function(){jQuery(".twbb-unlock-container").fadeIn()}))}),1e3)}),700*t)}))}jQuery("#trial-container").css("visibility","visible"),e=!0,t=!1,o(),function(){const t=[!0,!0,!0,!1];jQuery(".twbb-timeline-step").each((function(e){const o=t[e];jQuery(this).removeClass("completed pending").addClass(o?"completed":"pending")}))}()}